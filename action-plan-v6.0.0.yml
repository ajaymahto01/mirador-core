version: "6.0.0"
title: "Mirador Core v6.0.0 - Bleve Search Integration"
description: "Implementation of full Bleve search capabilities alongside existing Lucene functionality for logs and traces endpoints, with distributed scalable indexing"
created: "2025-10-04"
status: "planning"

phases:
  - name: "Phase 1: Core Architecture and Foundation"
    description: "Set up core components and base architecture for Bleve integration"
    status: "planning"
    tasks:
      - name: "Create search engine interface and router"
        description: "Design and implement a common interface for search engines and a router to direct queries to the appropriate translator"
        status: "planning"
        assignee: "developer"
        effort: "medium"
        dependencies: []
      
      - name: "Implement Bleve query translator"
        description: "Create a new package internal/utils/bleve with translator functionality leveraging Bleve's capabilities"
        status: "planning"
        assignee: "developer"
        effort: "large"
        dependencies: ["Create search engine interface and router"]
      
      - name: "Update model definitions"
        description: "Update request/response models to include search engine selection in all relevant APIs"
        status: "planning"
        assignee: "developer"
        effort: "small"
        dependencies: ["Create search engine interface and router"]
      
      - name: "Add configuration options"
        description: "Update internal/config/config.go to include Bleve-specific configuration options"
        status: "planning"
        assignee: "developer"
        effort: "small"
        dependencies: ["Create search engine interface and router"]
      
      - name: "Implement detection helpers"
        description: "Create utility functions to detect Bleve vs Lucene syntax for auto-detection capabilities"
        status: "planning"
        assignee: "developer"
        effort: "medium"
        dependencies: ["Implement Bleve query translator"]
      
      - name: "Update logs API handlers"
        description: "Modify internal/api/handlers/logsql.handler.go to support both Lucene and Bleve processing paths"
        status: "planning"
        assignee: "developer"
        effort: "medium"
        dependencies: ["Update model definitions", "Implement Bleve query translator"]
      
      - name: "Update traces API handlers"
        description: "Modify internal/api/handlers/traces.handler.go to support both Lucene and Bleve processing paths"
        status: "planning"
        assignee: "developer"
        effort: "medium"
        dependencies: ["Update model definitions", "Implement Bleve query translator"]
      
      - name: "Write unit tests for translator"
        description: "Create comprehensive test suite for the Bleve translator with both simple and complex queries"
        status: "planning"
        assignee: "developer"
        effort: "medium"
        dependencies: ["Implement Bleve query translator"]
      
      - name: "Write integration tests for API endpoints"
        description: "Develop end-to-end tests for the updated logs and traces endpoints with both engines"
        status: "planning"
        assignee: "developer"
        effort: "medium"
        dependencies: ["Update logs API handlers", "Update traces API handlers"]
      
      - name: "Update OpenAPI specification"
        description: "Add Bleve search capabilities to api/openapi.yaml including the new searchEngine parameter"
        status: "planning"
        assignee: "developer"
        effort: "small"
        dependencies: ["Update model definitions"]
      
  - name: "Phase 2: Distributed Index Architecture"
    description: "Implement scalable, distributed indexing for Bleve with tiered storage and sharding"
    status: "planning"
    tasks:
      - name: "Implement Valkey integration for metadata"
        description: "Create a metadata store using existing Valkey infrastructure for index coordination"
        status: "planning"
        assignee: "developer"
        effort: "medium"
        dependencies: ["Implement Bleve query translator"]
      
      - name: "Implement tiered storage strategy"
        description: "Design and implement a two-tiered storage strategy with in-memory cache backed by disk-based persistent storage"
        status: "planning"
        assignee: "developer"
        effort: "large"
        dependencies: ["Implement Valkey integration for metadata"]
      
      - name: "Create document mapping layer"
        description: "Implement mapping layer between Mirador data models and Bleve document structure"
        status: "planning"
        assignee: "developer"
        effort: "medium"
        dependencies: ["Implement tiered storage strategy"]
      
      - name: "Implement sharded index architecture"
        description: "Design and implement sharded index architecture with consistent hashing for horizontal scalability"
        status: "planning"
        assignee: "developer"
        effort: "large"
        dependencies: ["Create document mapping layer", "Implement Valkey integration for metadata"]
      
      - name: "Implement cluster coordination"
        description: "Create distributed index coordination mechanism using Valkey to maintain cluster-wide index state"
        status: "planning"
        assignee: "developer"
        effort: "large"
        dependencies: ["Implement sharded index architecture"]
      
      - name: "Implement index rebalancing"
        description: "Design and implement index rebalancing and recovery mechanisms for handling pod failures and cluster scaling events"
        status: "planning"
        assignee: "developer"
        effort: "large"
        dependencies: ["Implement cluster coordination"]
      
      - name: "Implement query caching with Valkey"
        description: "Use Valkey for caching Bleve query results to improve performance for repeated queries"
        status: "planning"
        assignee: "developer"
        effort: "medium"
        dependencies: ["Implement Valkey integration for metadata"]
      
      - name: "Implement distributed locks using Valkey"
        description: "Create locking mechanisms for coordinated index operations across the cluster"
        status: "planning"
        assignee: "developer"
        effort: "medium"
        dependencies: ["Implement Valkey integration for metadata"]
      
      - name: "Write distributed system tests"
        description: "Create unit and integration tests for distributed index operations, sharding, and fault tolerance"
        status: "planning"
        assignee: "developer"
        effort: "large"
        dependencies: ["Implement index rebalancing"]
      
  - name: "Phase 3: Performance and Monitoring"
    description: "Implement performance optimizations and comprehensive monitoring"
    status: "planning"
    tasks:
      - name: "Implement Prometheus metrics"
        description: "Develop comprehensive metrics collection for Bleve indexes exposed via Prometheus"
        status: "planning"
        assignee: "developer"
        effort: "medium"
        dependencies: ["Implement tiered storage strategy", "Implement sharded index architecture"]
      
      - name: "Create Grafana dashboard templates"
        description: "Develop Grafana dashboards to monitor Bleve search performance and index health"
        status: "planning"
        assignee: "developer"
        effort: "medium"
        dependencies: ["Implement Prometheus metrics"]
      
      - name: "Implement query analysis tools"
        description: "Create tools for analyzing query performance and identifying optimization opportunities"
        status: "planning"
        assignee: "developer"
        effort: "medium"
        dependencies: ["Implement Prometheus metrics"]
      
      - name: "Conduct performance benchmarks"
        description: "Develop benchmark suite to measure performance of Bleve vs Lucene for various query patterns"
        status: "planning"
        assignee: "developer"
        effort: "large"
        dependencies: ["Implement Bleve query translator", "Implement tiered storage strategy"]
      
      - name: "Optimize memory usage"
        description: "Tune memory usage and caching strategies for optimal performance"
        status: "planning"
        assignee: "developer"
        effort: "medium"
        dependencies: ["Conduct performance benchmarks"]
      
      - name: "Implement request throttling"
        description: "Add configurable request throttling to prevent resource exhaustion from complex queries"
        status: "planning"
        assignee: "developer"
        effort: "small"
        dependencies: ["Implement Prometheus metrics"]

  - name: "Phase 4: User Experience and Documentation"
    description: "Provide comprehensive documentation and tooling for users"
    status: "planning"
    tasks:
      - name: "Update user-facing API documentation"
        description: "Create comprehensive documentation for users on how to use both Lucene and Bleve queries"
        status: "planning"
        assignee: "developer"
        effort: "medium"
        dependencies: ["Update OpenAPI specification"]
      
      - name: "Create Postman collection"
        description: "Develop a Postman collection with example requests for both Lucene and Bleve queries"
        status: "planning"
        assignee: "developer"
        effort: "small"
        dependencies: ["Update OpenAPI specification"]
      
      - name: "Create operations documentation"
        description: "Develop comprehensive documentation for operators on cluster setup, monitoring, and scaling"
        status: "planning"
        assignee: "developer"
        effort: "medium"
        dependencies: ["Implement index rebalancing", "Implement Prometheus metrics"]
      
      - name: "Create Grafana plugin skeleton"
        description: "Develop a starter template for a Grafana plugin with query builder for Bleve and Lucene"
        status: "planning"
        assignee: "developer"
        effort: "large"
        dependencies: ["Update user-facing API documentation"]
      
      - name: "Update deployment configurations"
        description: "Update deployment configurations in deployments/ directory for clustered Bleve operation"
        status: "planning"
        assignee: "developer"
        effort: "medium"
        dependencies: ["Implement tiered storage strategy", "Implement sharded index architecture"]

  - name: "Phase 5: Backwards Compatibility and Testing"
    description: "Ensure comprehensive testing and backward compatibility"
    status: "planning"
    tasks:
      - name: "Implement backward compatibility tests"
        description: "Develop tests to ensure all existing Lucene queries continue to work correctly"
        status: "planning"
        assignee: "developer"
        effort: "medium"
        dependencies: ["Write integration tests for API endpoints"]
      
      - name: "Create migration guide"
        description: "Develop guide for users wanting to migrate from Lucene to Bleve queries"
        status: "planning"
        assignee: "developer"
        effort: "small"
        dependencies: ["Update user-facing API documentation"]
      
      - name: "Conduct security review"
        description: "Review Bleve implementation for potential security issues including query injection"
        status: "planning"
        assignee: "developer"
        effort: "medium"
        dependencies: ["Implement Bleve query translator"]
      
      - name: "Implement feature flags"
        description: "Add feature flags to enable/disable Bleve functionality globally or per-tenant"
        status: "planning"
        assignee: "developer"
        effort: "small"
        dependencies: ["Add configuration options"]
      
      - name: "Conduct load testing"
        description: "Perform load testing on the cluster to ensure stability under high query volume"
        status: "planning"
        assignee: "developer"
        effort: "large"
        dependencies: ["Implement index rebalancing", "Implement Prometheus metrics"]
      
      - name: "Execute end-to-end testing"
        description: "Conduct comprehensive E2E testing with real-world query patterns and data volumes"
        status: "planning"
        assignee: "developer"
        effort: "large"
        dependencies: ["Implement backward compatibility tests", "Conduct load testing"]
      
      - name: "Create A/B testing capability"
        description: "Implement capability to run queries against both engines and compare results for validation"
        status: "planning"
        assignee: "developer"
        effort: "medium"
        dependencies: ["Update logs API handlers", "Update traces API handlers"]

quality_gates:
  - name: "No regression in existing Lucene functionality"
    criteria: "100% pass rate on backward compatibility tests"
  
  - name: "Performance benchmarks meet targets"
    criteria: "Bleve search performs within 150% latency of Lucene for 95th percentile queries"
  
  - name: "Horizontal scalability verified"
    criteria: "Demonstrated linear scaling with added nodes up to 10-node cluster"
  
  - name: "Resource usage within bounds"
    criteria: "Memory usage below 2GB per instance at 100K documents per shard"
  
  - name: "High availability maintained"
    criteria: "Zero data loss during simulated node failures"

risks:
  - description: "Query syntax differences between Lucene and Bleve may cause confusion for users"
    mitigation: "Provide clear documentation and examples for both syntaxes"
    severity: "medium"
  
  - description: "Performance of Bleve may not match Lucene for all query patterns"
    mitigation: "Identify performance gaps early and optimize critical paths"
    severity: "medium"
  
  - description: "Distributed indexing adds complexity to deployment and operations"
    mitigation: "Comprehensive documentation and monitoring tools"
    severity: "high"
  
  - description: "Memory usage could spike with large indexes"
    mitigation: "Implement tiered storage with configurable memory limits"
    severity: "medium"
  
  - description: "Cluster coordination failures could impact search availability"
    mitigation: "Fallback mechanisms and graceful degradation patterns"
    severity: "high"